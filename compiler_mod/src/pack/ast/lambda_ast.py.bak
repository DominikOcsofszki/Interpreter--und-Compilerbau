# local assignment in expr

from environment import Env
from pack.ast.Expression import InterpretedExpression, getAllClasses, ic
from pack.ast.local_ast import LocalExpression

class LambdaExpression(InterpretedExpression):
    # class LocalExpression(InterpretedExpression):
    # def __init__(self, x, body):
    #     self.x=x
    #     self.body=body
    #

    def __init__(self, id, body_lambda):
        ic("==============lambda_init===============")
        self.id=id
        self.body_lambda=body_lambda

    def eval(self,env):
        ic("=====================================================================")
        ic("==============lambda_eval===============")
        ic(env)
        ic("1:",self.id)
        ic("2:",self.id.eval(env))

        id, env_tmp = self.id.eval(env)

        def lmbd(val):
            # locExp = LocalExpression(self.id, val, self.body_lambda)
            new_env = Env()
            ic(id)
            ic("=====================================================================")
            new_env[self.id] = val
            ic(new_env)
            # ic(new_env.parent)
            # new_env.parent = env
            ic(">>>>",new_env)
            ic(val)
            ic(">>>>")
            res, env_tmp = self.body_lambda.eval(new_env)
            # env_tmp =Env({self.id:val})
            # ic(">>>>>",env_tmp)
            # return locExp.eval(env)
            ic(">>>>",res)
            return res
        return lmbd, env

    # def eval(self,env):
    #     def lmbd(self,value):
    #         env = Env()
    #         # local_value, old_val = self.value.eval(env)
    #         # local_value, old_val = value.eval(env)
    #         old_val = env[self.x]
    #         env[self.x] = value
    #         res, env = self.body.eval(env)
    #         if old_val:
    #             env[self.x] = old_val
    #         ic(res)
    #         return res
    #     return lmbd, env

class CallExpression(InterpretedExpression):
    def __init__(self,fn,x):
        ic("==============cal_init===============")
        self.x=x
        self.fn=fn

    def eval(self,env):
        ic("==============cal_eval===============")
        fn, env = self.fn.eval(env)
        x, env = self.x.eval(env)
        ic(fn)
        ic(x)
        ic(env)
        return fn(self.x), env

used_procedures_and_classes = getAllClasses()

# asd -> {
# asd + 11;
# }
